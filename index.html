<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Map with Filters</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inclusive+Sans:ital@0;1&display=swap");
        .info-window {
            font-family: 'Arial', sans-serif;
            color: #333;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .info-window-header {
            background-color: #f2f2f2;
            padding: 10px;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }

        .info-window-body {
            padding: 15px;
        }

        #map {
            width: calc(100% - 250px);
            height: 100vh;
            float: right;
            transition: width 0.5s;
        }

        .gm-style-mtc {
        top: 12px; /* Adjust the top position */
        right: -50px; /* Adjust the right position */
}

        body {
            margin: 0px;
            padding: 0px;
        }

        #controls {
            width: 250px;
            position: fixed; /* Change position to fixed */
            top: 0;
            left: 0;
            bottom: 0; /* Stretch to the bottom */
            z-index: 5;
            background: #2c3e50;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.3);
            overflow-y: auto;
            transition: left 0.5s;
        }


        #controls.collapsed {
            left: -250px;
        }


        #page-link {
            color: #383734;
        }

        #page-link:hover {
            color: black;
        }

        #page-link:active {
            color: black;
        }

        #toggleButton {
            padding: 10px 15px;
    background-color: #2980b9; /* A shade of blue */
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    transition: background-color 0.3s, box-shadow 0.3s;
        }
        .logo-banner-container {
    position: relative;
    display: inline-block; /* Or 'block', depending on your layout */
}

.searchInput{
    box-shadow: 0 0 8px rgba(245,245,245,0.984);
    font-family: "Inclusive Sans", sans-serif;
    font-style: italic;
}

.stateSelect{
    box-shadow: 0 0 8px rgba(245,245,245,0.984);
    position: relative;
    font-family: "Inclusive Sans", sans-serif;
    font-weight: 570;
    font-style: italic;
}

.citySelect{
    box-shadow: 0 0 8px rgba(245,245,245,0.984);
    position: relative;
    font-family: "Inclusive Sans", sans-serif;
    font-weight: 570;
    font-style: italic;
}

.majorSelect{
    box-shadow: 0 0 8px rgba(245,245,245,0.984);
    position: relative;
    font-family: "Inclusive Sans", sans-serif;
    font-weight: 570;
    font-style: italic;
}


.logo {
    width: 200px; 
    height: auto;
    display: block;
}

.banner {
    position: absolute;
    top: 50%; /* Adjust to place it over the desired part of the logo */
    left: 0;
    width: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
    color: white;
    text-align: center;
    padding: 5px 0;
    transform: translateY(-50%); /* Centers the banner vertically */
    font-size: 18px; /* Adjust as needed */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); /* Optional shadow for depth */
}

        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 1px solid #34495e;
            background-color: #ecf0f1;
            color: #34495e;
            font-size: 16px;
            box-sizing: border-box;
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 5px rgba(41, 128, 185, 0.5);
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 1px solid #34495e;
            background-color: #ecf0f1;
            color: #34495e;
            font-size: 16px;
            box-sizing: border-box;
        }

        #searchInput:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 5px rgba(41, 128, 185, 0.5);
        }
        button {
          
          border-radius: 8px;
          cursor: pointer;
          appearance: none;
          background-color: white;
          transition: transform .7s ease-in-out;
          
      }
        button:hover {
            background-color: lightgray;
            transform: rotate(360deg);
        }
        .button-container {
            position: fixed;
            bottom: 5px;
            left: 5px;
            /*transform: translateX(-50%);*/
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .button-container form {
            margin: 5px;
        }
        img {
          width: 20px;
          height: 20px;
        }
        .banner-container {
    background-color: #333;
    padding: 10px 0;
    display: flex;
    align-items: center; /* Vertically center items */
    justify-content: center;
    color: white;
}

.banner-logo {
    width: 250px; /* Adjust width as needed */
    height: auto;
    margin-right: -15px; /*  negative margin to bring the logo closer */
}

.app-name-image {
    width: 450px; /* Adjust width as needed */
    height: auto;
    margin-left: -20px; /* negative margin to bring the app name closer */
    margin-top: 20px; /* Add margin to lower the app name image */
}


    </style>
</head>
<body>
    <div class="banner-container">
        <img src="Map_My_Degree.png" alt="Logo" class="banner-logo">
        <img src="Map_My_Degree_Words.png" alt="App Name" class="app-name-image">
    </div>
    <div id="controls">
        <input type="text" id="searchInput" placeholder="Search for schools" class="searchInput" oninput="searchSchools()">
        <select id="stateSelect" class="stateSelect" onchange="onStateChange()">
        <!--<input type="text" id="searchInput" placeholder="Search for schools" oninput="searchSchools()">
        <select id="stateSelect" onchange="onStateChange()">-->
            <option value="">Select State</option>
        </select>
        <select id="citySelect" class="citySelect" onchange="filterMarkers()">
            <option value="">Select City</option>
        </select>
        <select id="majorSelect" class="majorSelect" onchange="filterMarkers()">
            <option value="">Select Major</option>
        </select>
        <!---
        <input type="number" id="actScore" placeholder="ACT Score" onchange="filterMarkers()">
        -->
        <label for="actScore" style="color:white">ACT Score:</label>
<input type="range" id="actScore" min="1" max="36" value="36" oninput="updateACTScoreDisplay(this.value); filterMarkers();" />
<span id="actScoreDisplay" style="color:white">36</span>

<label for="instate" style="color:white">Instate:</label>
<input type="range" id="instate" min="1" max="50000" value="50000" oninput="updateINStateDisplay(this.value); filterMarkers();" />
<span id="INStateDisplay" style="color:white">50000</span>

<label for="outstate" style="color:white">outstate:</label>
<input type="range" id="outstate" min="1" max="50000" value="50000" oninput="updateOUTStateDisplay(this.value); filterMarkers();" />
<span id="OUTStateDisplay" style="color:white">50000</span>

        <div class="button-container">
            <form><button type="submit" formaction="info.html">
            <img src="infologo.png" alt="buttonpng" border="0" />
        </button></form>
        <button id="toggleButton">Toggle Sidebar</button>
        </div>
    </div>
    <div id="map"></div>

    <script>
        function updateACTScoreDisplay(value) {
    document.getElementById('actScoreDisplay').textContent = value;
}
function updateINStateDisplay(value) {
    document.getElementById('INStateDisplay').textContent = value;
}
function updateOUTStateDisplay(value) {
    document.getElementById('OUTStateDisplay').textContent = value;
}



        let map, markers = [], stateCities = {}, majorTitles = new Set();

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 4,
                center: { lat: 33.5, lng: -86.8 }
            });

            
        fetch('data/last.json')
            .then(response => response.json())
            .then(data => {
                let openInfoWindow = null;
                data.features.forEach(feature => {
                    const coords = feature.geometry.coordinates;
                    const latLng = new google.maps.LatLng(coords[1], coords[0]);
                    const state = feature.properties.STATE;
                    const city = feature.properties.CITY;

                    if (!stateCities[state]) {
                        stateCities[state] = new Set();
                    }
                    stateCities[state].add(city);

                    if (feature.properties.programs) {
                        feature.properties.programs.forEach(program => {
                            if(program.level === "Bachelor's Degree"){
                                majorTitles.add(program.title);
                            }
                        });
                    }

                    const schoolName = feature.properties.NAME; // Extract school name
const marker = new google.maps.Marker({
    position: latLng,
    map: map,
    title: `${schoolName}, ${city}, ${state}`,
    state: state,
    city: city,
    programs: feature.properties.programs ? feature.properties.programs.map(program => program.title) : [],
    actScores: feature.properties.act_scores,
    instate: feature.properties.in_state_tuition,
    outstate: feature.properties.out_of_state_tuition,
    
    icon: '/data/photo.png',
    schoolName: schoolName, // Set schoolName property
});
markers.push(marker);
                    var url_extracted = feature.properties.school_url;
                    const infoWindow = new google.maps.InfoWindow({
                        content: '<h3 id="popupTitle">'+feature.properties.NAME+'</h3>'
                        +'<p id="popup">'+feature.properties.address+'</p>'
                        +'<p id="popup">'+feature.properties.city+', '+feature.properties.state+' '+feature.properties.zip_code+'</p>'+'<br />'
                        +'<p id="popup">'+"In State Tuition: $"+(feature.properties.in_state_tuition ? feature.properties.in_state_tuition.toLocaleString() : 'N/A')+'</p>'
                        +'<p id="popup">'+"Out of State Tuition: $"+(feature.properties.out_of_state_tuition ? feature.properties.out_of_state_tuition.toLocaleString() : 'N/A')+'</p>'+'<br />'
                        +'<a id="page-link" href=http://'+url_extracted+' target="_blank">'+"View University Page"+'</a>'
                        +'<p id="popup">'+"URL: "+feature.properties.school_url+'</p>'
                    });
                    marker.infoWindow = infoWindow;

                    marker.addListener('click', function () {

                        if (openInfoWindow) {
            openInfoWindow.close();
        }

                        infoWindow.open(map, marker);
                        map.setZoom(10);
                        map.setCenter(marker.getPosition());

                        openInfoWindow = infoWindow;
                    });
                });

                populateStateDropdown();
                populateMajorDropdown();
            })
            .catch(error => console.error('Error loading JSON data:', error));
    }

    function populateStateDropdown() {
    const stateSelect = document.getElementById('stateSelect');
    stateSelect.innerHTML = '<option value="">Select State</option>';
    Object.keys(stateCities).sort().forEach(state => {
        const option = document.createElement('option');
        option.value = state;
        option.textContent = state;
        stateSelect.appendChild(option);
    });
}

function populateCityDropdown(selectedState) {
    const citySelect = document.getElementById('citySelect');
    citySelect.innerHTML = '<option value="">Select City</option>';

    if (selectedState && stateCities[selectedState]) {
        Array.from(stateCities[selectedState]).sort().forEach(city => {
            const option = document.createElement('option');
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
        });
    }
}

function populateMajorDropdown() {
    const majorSelect = document.getElementById('majorSelect');
    majorSelect.innerHTML = '<option value="">Select Major</option>';
    Array.from(majorTitles).sort().forEach(major => {
        const option = document.createElement('option');
        option.value = major;
        option.textContent = major;
        majorSelect.appendChild(option);
    });
}

function onStateChange() {
            const selectedState = document.getElementById('stateSelect').value;
            populateCityDropdown(selectedState);
            filterMarkers();
        }
       
/*
function filterMarkers() {
    const selectedState = document.getElementById('stateSelect').value;
    const selectedCity = document.getElementById('citySelect').value;
    const selectedMajor = document.getElementById('majorSelect').value;
    const selectedACTScore = parseInt(document.getElementById('actScoreDisplay').value, 10);

    markers.forEach(marker => {
        const matchState = selectedState === '' || marker.state === selectedState;
        const matchCity = selectedCity === '' || marker.city === selectedCity;
        const matchMajor = selectedMajor === '' || marker.programs.includes(selectedMajor);
        const matchACTScore = isNaN(selectedACTScore) || (marker.actScores && marker.actScores.includes(selectedACTScore));

        marker.setVisible(matchState && matchCity && matchMajor && matchACTScore);
    });
}
*/


function filterMarkers() {
    const selectedState = document.getElementById('stateSelect').value;
    const selectedCity = document.getElementById('citySelect').value;
    const selectedMajor = document.getElementById('majorSelect').value;
   // const selectedDegreeLevel = document.getElementById('degreeLevelSelect').value;
    const selectedACTScore = parseInt(document.getElementById('actScore').value, 10);
    const selectedInstate = parseInt(document.getElementById('instate').value, 10);
    const selectedOutstate = parseInt(document.getElementById('outstate').value, 10);
    //const searchTerm = document.getElementById('searchBar').value.toLowerCase();

    markers.forEach(marker => {
        const matchState = selectedState === '' || marker.state === selectedState;
        const matchCity = selectedCity === '' || marker.city === selectedCity;
        const matchMajor = selectedMajor === '' || marker.programs.includes(selectedMajor);
       // const matchDegreeLevel = selectedDegreeLevel === '' || marker.degreeLevels.includes(selectedDegreeLevel);
        const matchACTScore = isNaN(selectedACTScore) || (marker.actScores && marker.actScores.cumulative <= selectedACTScore);
        const matchInstate = isNaN(selectedInstate) || (marker.instate && marker.instate <= selectedInstate);
        const matchOutstate = isNaN(selectedOutstate) || (marker.outstate && marker.outstate <= selectedOutstate);
       // const matchSearch = searchTerm === '' || marker.name.toLowerCase().includes(searchTerm);
       const isVisible = matchState && matchCity && matchMajor && matchACTScore && matchInstate &&matchOutstate ;
        
        marker.setVisible(isVisible);

        // Close the info window associated with the marker if it's not visible
        if (!isVisible && marker.infoWindow) {
            marker.infoWindow.close();
        }
    });
}

function searchSchools() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.toLowerCase();

            markers.forEach(marker => {
                const schoolName = marker.schoolName.toLowerCase();
                const matchSearchTerm = schoolName.includes(searchTerm);

                marker.setVisible(matchSearchTerm);
            });
        }

    document.getElementById('toggleButton').addEventListener('click', function() {
        const controls = document.getElementById('controls');
        const map = document.getElementById('map');

        if (controls.classList.contains('collapsed')) {
            controls.classList.remove('collapsed');
            map.style.width = 'calc(100% - 250px)';
        } else {
            controls.classList.add('collapsed');
            map.style.width = '100%';
        }
    });

function loadGoogleMapsScript() {
const script = document.createElement("script");
script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyD1e_KlIlKeCykamE8IhKtJdSGpS3ZsNXA&callback=initMap`;
script.async = true;
document.body.appendChild(script);
}


loadGoogleMapsScript();


</script>
</body>
</html>
